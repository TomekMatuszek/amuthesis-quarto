# Source data {#sec-data}

Satellite imagery used in our model was downloaded from Landsat ARD dataset, provided by GLAD laboratory at the University of Maryland [@potapov2020].
Training points were obtained from LUCAS dataset created by Eurostat [@dandrimont2020].
This data was pre-processed and then used to train the model and validate its performance.
Middle-West Poland was chosen as a training area for which satellite imagery and land cover data were downloaded (Figure [-@fig-rycina1]).

```{r}
#| label: fig-rycina1
#| echo: false
#| fig-cap: "Training area"
#| out-width: "100%"
#| out-height: 400px
knitr::include_graphics("figures/study_area.png")
```

## Satellite imagery {#sec-sat}

Satellite imagery from GLAD Landsat ARD is available in 16-day interval composites and is divided into 1 x 1 geographic degrees tiles.
Processing of original Landsat images performed by GLAD team included conversion of spectral bands to top-of-atmosphere (TOA) reflectance, conversion of thermal band to brightness temperature (BT) in Kelvins, scaling the values of all bands as well as adding quality flag for every pixel [@potapov2020].

Satellite images for eight 1 x 1 degree tiles (Figure [-@fig-rycina1]) were downloaded using GLAD Tools v1.1 and PERL programming language.
These images come from 10th interval of the year 2018, so downloaded mosaics consist of images created between 24.05.2018 and 8.06.2018.
All downloaded images were merged and reprojected from WGS84 coordinate reference system (EPSG:4326) to UTM zone 33N (EPSG:32633).
Every band was also resampled to 30 meters resolution.
In addition, four spectral indices were derived: Normalized Difference Vegetation Index (NDVI), Modified Normalized Difference Water Index (MNDWI), Normalized Difference Moisture Index (NDMI) and Modified Bare soil Index (MBI).
Formulas used to calculate these indices can be found in below table (Table [-@tbl-tabela1]).

```{r tabela1, echo=FALSE}
#| label: tbl-tabela1
#| echo: false
#| tbl-cap: "Formulas of spectral indices dervied from Landsat data"
df = data.frame(a = 1:5, b = letters[1:5])
knitr::kable(df, booktabs = TRUE) |> 
  kableExtra::column_spec(1, width = "2cm") |>  
  kableExtra::column_spec(2, width = "4cm")
```

-   preprocessing of satellite imagery performed by GLAD team from University of Maryland

-   process of downloading data using GLAD ARD software

-   GLAD ARD dataset structure

## Land cover data {#sec-landcover}

Regarding land cover training set, data collected during LUCAS survey was chosen.
It seems to be the most accurate and comprehensive dataset containing information about land use and land cover [@pflugmacher2019] due to the fact, that every point was either photo-interpreted by human or assessed during *in-situ* visit.

Survey consists of two phases.
First phase is based on grid of points with 2km spacing covering whole territory of the European Union (which is above 1 million points).
Each point of the grid is visually interpreted using ortho-photos or satellite images, and classified into one of seven land-cover classes.
These are: arable land, permanent crops, grassland, wooded areas/shrub land, bare land, artificial land and water.
In the second phase a subsample of grid points is selected and then visited by Eurostat surveyors.
They classify each point according to full LUCAS land cover and land use classification.
The survey takes place in the spring and summer in order to observe chosen places in high vegetation season.

Surveyor not only assign a land cover and land use classes to a point, but they also add auxillary information such as plant species present at the site, percentage of land coverage for chosen class, height of the trees and their maturity as well as information about water management and irrigation.
If there are more than one land cover/land use types at the point, observer can also assign secondary class for every LUCAS point.
TUTAJ BĘDZIE REFERENCJA DO LUCAS COPERNICUS REPORT GDY DOWIEM SIĘ, JAK GO CYTOWAĆ

Majority of the training points used to train our classification model were points from the second phase of LUCAS survey, also called LUCAS Micro Data.
We downloaded a total of 4153 points for our study area.
Pre-processing step included omitting records with missing data, excluding linear artificial land cover classes and excluding points that were surveyed more than 500 meters from their theoretical location.
In the next step, detailed land cover classes were aggregated into eight main groups of land cover types.
Then, we filtered some of the classes according to the percentage of land coverage or percentage of impervious surface coverage.

For the least frequent classes in the LUCAS Micro Data dataset - bare land, artificial land and water bodies - we also added points classified during the first phase of LUCAS survey.
This step was necessary to ensure that every land cover class is represented by enough number of points.
At the end of the pre-processing, we were left with 3778 training points.

```{r}
#| label: fig-rycina2
#| echo: false
#| fig-cap: "Distribution of land cover classes after pre-processing"
#| out-width: "100%"
#| out-height: 400px
knitr::include_graphics("figures/lucas_data.png")
```

Later in the analysis, after extracting values from Landsat ARD raster, LUCAS points were also filtered using quality flag provided.
Only points with clear-sky quality flag were taken into account during the process of model training.
We also excluded water bodies points in which NDWI was lower than 0.
These two conditions excluded over 400 points in total.

```{r}
#| label: fig-rycina3
#| echo: false
#| fig-cap: "Spatial distribution of LUCAS training points after pre-processing"
#| out-width: "100%"
#| out-height: 400px
knitr::include_graphics("figures/lucas_distribution.png")
```

-   what is LUCAS programme and how its datasets are created

-   LUCAS Grid and LUCAS Micro Data

-   structure of LUCAS points dataset, description of relevant columns in addition to the land cover classification

-   processing of data in order to choose reliable training points; reclassification to chosen set of land cover categories:

    -   excluding railways, runways, roads and temporary grasslands from LUCAS Micro Data

    -   reclassifying LUCAS Micro Data to seven main classes

    -   filtering of training points based on auxillary information (% of impervious surface or according land cover type)

    -   adding LUCAS Grid data to three less frequent classes (with smaller weight)

    -   choose only points where quality flag of Landsat ARD image was "clear sky"

    -   choose only these points from water category where NDWI was above 0

-   example of training points spatial distribution

-   table with land cover categories

------------------------------------------------------------------------

Celem tego rozdziału jest przedstawienie użytych w pracy danych.
Należy wyjaśnić jakie dane zostały użyte, jakiego są one rodzaju, dla jakiego okresu zostały pobrane/stworzone, co one zawierają, etc.

W tym rozdziale warto dodać ryciny i tabele przedstawiające użyte dane.

Zwróć uwagę, że poniższe bloki kodu mają parametr `#| echo: false`; oznacza to, że będą one niewidoczne w wynikowym pliku PDF.
Każdy z bloków kodu musi mieć unikalną nazwę; w przypadku rycin powinna się ona rozpoczynać od prefiksu `fig-`.
Dodanie podpisu pod rycinę odbywa się używając parametru `#| fig-cap:`.
Następnie do tej ryciny można się odnieść używając operatora `[-@]`.

Podobnie wygląda odnoszenie się do plików graficznych.
Tutaj wewnątrz bloku kodu należy użyć funkcji `knitr::include_graphics()` (Rycina).
Dodatkowo możliwa jest zmiana rozmiary obrazka używając parametrów takich jak `#| out-width:` i `#| out-height:`.Odnoszenie się do tabel odbywa się poprzez operator `[-@]` wraz z prefiksem `tbl-`.
Natomiast tworzenie podpisu nad tabelą ma miejsce używając parametru `#| tbl-cap:`.
Dodatkowo możliwe jest użycie pakietu **kableExtra** [@R-kableExtra] do określenia szerokości kolumn (Tabela).
